--- /home/jrd/salix/sysvinit-scripts/tags/13.0.2/rc.M	2010-04-30 14:42:40.000000000 +0200
+++ root/etc/rc.d/rc.M	2010-07-14 13:48:35.089492446 +0200
@@ -10,9 +10,17 @@
 # Author:	Fred N. van Kempen, <waltje@uwalt.nl.mugnet.org>
 #		Heavily modified by Patrick Volkerding <volkerdi@slackware.com>
 #
+### Modified for Live ###
+#
+
 
 [ ! -z `pidof -o %PPID /usr/sbin/splashy` ] &&	/usr/sbin/splashy_update "progress 60"
 
+### modified for Live ###
+## LiveCD library
+. /usr/lib/liblinuxlive
+### /modified for Live ###
+
 # Tell the viewers what's going to happen.
 echo "Going multiuser..."
 
@@ -68,6 +76,12 @@
   . /etc/rc.d/rc.syslog start
 fi
 
+# Update the X font indexes:
+if [ -x /usr/bin/fc-cache ]; then
+  echo "Updating X font indexes:  /usr/bin/fc-cache -f &"
+  /usr/bin/fc-cache -f &
+fi
+
 [ ! -z `pidof -o %PPID /usr/sbin/splashy` ] && /usr/sbin/splashy_update "progress 70"
 
 # If we are returning from single-user mode we will need to restart
@@ -127,26 +141,62 @@
   . /etc/rc.d/rc.acpid start
 fi
 
+# Update any existing icon cache files:
+if find /usr/share/icons 2> /dev/null | grep -q icon-theme.cache ; then
+  for theme_dir in /usr/share/icons/* ; do
+    if [ -r ${theme_dir}/icon-theme.cache ]; then
+      echo "Updating icon-theme.cache in ${theme_dir}..."
+      /usr/bin/gtk-update-icon-cache -t -f ${theme_dir} 1> /dev/null 2> /dev/null &
+    fi
+  done
+  # This would be a large file and probably shouldn't be there.
+  if [ -r /usr/share/icons/icon-theme.cache ]; then
+    echo "Deleting icon-theme.cache in /usr/share/icons..."
+    #/usr/bin/gtk-update-icon-cache -t -f /usr/share/icons 1> /dev/null 2> /dev/null &
+    rm -f /usr/share/icons/icon-theme.cache
+  fi
+fi
+
+# Update mime database:
+if [ -x /usr/bin/update-mime-database -a -d /usr/share/mime ]; then
+  echo "Updating MIME database:  /usr/bin/update-mime-database /usr/share/mime &"
+  /usr/bin/update-mime-database /usr/share/mime 1> /dev/null 2> /dev/null &
+fi
+
 # Start D-Bus:
 if [ -x /etc/rc.d/rc.messagebus ]; then
   sh /etc/rc.d/rc.messagebus start
 fi
 
+### modified for Live ###
 # Start HAL:
-if [ -x /etc/rc.d/rc.hald ]; then
-  sh /etc/rc.d/rc.hald start
-fi
+#if [ -x /etc/rc.d/rc.hald ]; then
+#  sh /etc/rc.d/rc.hald start
+#fi
 
 # Start Bluetooth:
-if [ -x /etc/rc.d/rc.bluetooth ]; then
-  sh /etc/rc.d/rc.bluetooth start
-fi
+#if [ -x /etc/rc.d/rc.bluetooth ]; then
+#  sh /etc/rc.d/rc.bluetooth start
+#fi
+### /modified for Live ###
 
 # Start wicd:
 if [ -x /etc/rc.d/rc.wicd ]; then
   sh /etc/rc.d/rc.wicd start
 fi
 
+# These GTK+/pango files need to be kept up to date for
+# proper input method, pixbuf loaders, and font support.
+if [ -x /usr/bin/update-gtk-immodules ]; then
+  /usr/bin/update-gtk-immodules --verbose
+fi
+if [ -x /usr/bin/update-gdk-pixbuf-loaders ]; then
+  /usr/bin/update-gdk-pixbuf-loaders --verbose
+fi
+if [ -x /usr/bin/update-pango-querymodules ]; then
+  /usr/bin/update-pango-querymodules --verbose
+fi
+
 [ ! -z `pidof -o %PPID /usr/sbin/splashy` ] && /usr/sbin/splashy_update "progress 80"
 
 # Start dnsmasq, a simple DHCP/DNS server:
@@ -274,10 +324,16 @@
   . /etc/rc.d/rc.alsa
 fi
 
+#### modified for Live ###
 # Load a custom keymap if the user has an rc.keymap script.
-if [ -x /etc/rc.d/rc.keymap ]; then
-  . /etc/rc.d/rc.keymap
+#if [ -x /etc/rc.d/rc.keymap ]; then
+#  . /etc/rc.d/rc.keymap
+#fi
+
+if [ -x /etc/rc.d/rc.live ]; then
+  . /etc/rc.d/rc.live
 fi
+#### /modified for Live ###
 
 # Start the MySQL database:
 if [ -x /etc/rc.d/rc.mysqld ]; then
